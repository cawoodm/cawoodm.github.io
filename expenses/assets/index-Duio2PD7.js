(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function n(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(r){if(r.ep)return;r.ep=!0;const a=n(r);fetch(r.href,a)}})();const T=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,S=Math.floor(window.innerWidth*.9),y=Math.floor(150*S/320);let I=parseFloat(localStorage.getItem("max")||"3000"),b=parseFloat(localStorage.getItem("budget")||"2000"),v=localStorage.getItem("graphtype")||"bar",l=[];const L=document.getElementById("canvas");L.width=S;L.height=y;const d=L.getContext("2d"),$=document.querySelector("#periodFilter"),D=document.querySelector("#periodFilter2"),U=document.querySelector("#categories"),X=document.querySelector("#payments"),Q=document.querySelector("#total"),Z=document.querySelector("#percentage"),ee=document.getElementById("frmImport"),x=document.getElementById("expenses"),te=document.getElementById("frmSettings"),ne=document.getElementById("search"),M=document.getElementById("progress"),O=document.querySelector("#toast");var N;(N=document.getElementById("btnImport"))==null||N.addEventListener("click",G);var H;(H=document.getElementById("btnExample"))==null||H.addEventListener("click",me);var B;(B=document.getElementById("btnClear"))==null||B.addEventListener("click",fe);var R;(R=document.getElementById("btnAddExpense"))==null||R.addEventListener("click",re);var k;(k=document.getElementById("btnSaveSettings"))==null||k.addEventListener("click",ue);var j;(j=document.getElementById("search"))==null||j.addEventListener("keyup",p);D.addEventListener("ionChange",p);$.addEventListener("ionChange",p);document.addEventListener("ionViewDidEnter",q);function q(){x.elements.date.value=u(new Date,"y-M-d"),l.length==0&&confirm("No payments found. Load example data?")&&(W(),G())}function oe(){localStorage.getItem("payments")||localStorage.setItem("payments","[]"),setTimeout(q,1e3),l=JSON.parse(localStorage.getItem("payments")||"[]"),l=l.filter(n=>ae(n.name,n.date,n.category,n.amount)),l.forEach(n=>{n.date=new Date(n.date).toISOString(),n.amount=parseFloat(n.amount.toString()),n.period=u(n.date,"y-M"),n.day=u(n.date,"y-M-d")});let t=new Date(u(new Date,"y-M")+"-01");t.setTime(t.getTime()-24*60*60*1e3);let e=u(t,"y-M");z(u(new Date,"y-M"),e),p(),E("budget",b),E("max",I),E("graphType",v)}function re(){const t=Object.assign(...Array.from(new FormData(x).entries(),([e,n])=>({[e]:n})));_(t)&&(g(`Payment ${t.amount} ${t.name} (${t.category}) saved`),p(),V())}function g(t){O.message=t,O.present()}function _({name:t,date:e,category:n,amount:o}){const r=new Date,a=new Date(e);a.setHours(r.getHours(),r.getMinutes(),r.getSeconds());try{C(t,a,n,o);const s=ye(length),c=u(a,"y-M"),i=u(a,"y-M-d");return o=parseFloat(o),l.find(m=>m.day===i&&m.category===n&&m.amount===o)&&console.warn(`Possible duplicate payment: day: ${i}, category: ${n}, amount=${o}`),l.push({id:s,name:t,category:n,amount:o,date:a.toISOString(),period:c,day:i}),l=l.sort(we),de(l[l.length-1]),F(),!0}catch(s){return g(`ERROR: ${s.message} in record ${t}, ${e}, ${n}, ${o}`),!1}}function ae(t,e,n,o){try{return C(t,e,n,o),!0}catch{return!1}}function C(t,e,n,o){if(!e||!Date.parse(e))throw new Error(`Date missing/invalid in record ${t}, ${e}, ${n}, ${o}`);if(!t)throw new Error(`Text missing in record ${t}, ${e}, ${n}, ${o}`);if(!n)throw new Error(`Category missing in record ${t}, ${e}, ${n}, ${o}`);if(isNaN(parseFloat(o)))throw new Error(`Amount must be a number in record ${t}, ${e}, ${n}, ${o}`);return!0}function ie(t){confirm("Definitely delete?")&&(l=l.filter(e=>e.id!==t),F(),p())}window.deletePayment=ie;function p(){const t=ne.value||"",e=$.value,n=D.value,o=l.filter(i=>!e||i.period===e).filter(se(t)),r=o.map(i=>i.amount).reduce((i,m)=>i+m,0);let a=r/b;M.value=a,a>1?M.color="danger":M.color="primary",Z.innerHTML=Math.floor(a*100)+"%",Q.innerHTML="CHF "+r.toFixed(2);let s='<ion-grid fixed="true">',c="";o.map(i=>({...i,amountFormatted:i.amount.toFixed(2)})).forEach(i=>{c!==i.day&&(s+=`<ion-row style="background-color: silver"><ion-col size="12"><b>${$e(i.date)}</b></ion-col></ion-row>`),c=i.day,s+=`<ion-row><ion-col size="2" title="${i.date}">${Se(i.date)}</ion-col><ion-col size="6" class="ion-text-nowrap">${i.name}</ion-col><ion-col size="3" class="ion-text-right">${i.amountFormatted}</ion-col><ion-col size="1"><a href="javascript:deletePayment('${i.id}')"><ion-icon name="trash-outline"></ion-icon></a></ion-row>`}),s+="</ion-grid>",X.innerHTML=s,(e||n)&&Y(),n&&A(n,"red"),e&&A(e,"blue")}function se(t){return e=>!t||[e.name,e.category,e.amount,e.day].join(" ").toLowerCase().includes(t.toLowerCase())}function z(t,e){le(t,e),V()}function le(t,e){let n=Array.from(new Set(l.map(o=>o.period).sort(he)));$.innerHTML=n.map(o=>`<ion-select-option ${o===t?"selected":""} value="${o}">${o}</ion-select-option>`).join(`
`),$.value=t,D.innerHTML=n.map(o=>`<ion-select-option ${o===e?"selected":""} value="${o}">${o}</ion-select-option>`).join(`
`),D.value=e}function V(t){let e=Array.from(new Set(l.map(n=>n.category).sort(pe)));U.innerHTML=e.map(n=>`<ion-chip onclick="setCategory(this, '${n}')">${n}</ion-chip>`).join(`
`)}let P=null;function ce(t,e){P&&P.setAttribute("color",""),t.setAttribute("color","primary"),x.category.value=e,P=t}window.setCategory=ce;function A(t,e){let n=l.filter(c=>c.period===t),o=0;const r=K(t);let a={red:"rgba(255, 0, 0, 0.5)",green:"rgba(0, 255, 0, 0.5)",blue:"rgba(0, 0, 255, 0.5)"}[e];const s=new Date;r.forEach(c=>{const i=n.filter(f=>f.day>c);if(new Date(c)>s&&i.length==0)return;const h=n.filter(f=>f.day===c).reduce((f,w)=>f+w.amount,0);o+=h,J(r.indexOf(c),o,a)})}const de=console.log;function ue(){let t=te,e=isNaN(parseFloat(t.budget.value))?0:parseFloat(t.budget.value);if(!e)return g("Invalid budget");let n=isNaN(parseFloat(t.max.value))?0:parseFloat(t.max.value);if(!n)return g("Invalid max spend");v=t.graphType.value,localStorage.setItem("budget",e.toString()),localStorage.setItem("max",n.toString()),localStorage.setItem("graphtype",v),b=e,I=n,Y(),p()}function G(){try{const t=ee.import.value;if(!t)throw new Error("No data to import");let e=t.split(`
`);if(!e.length)throw new Error("No data to import");let n="	",o=e[0].split(n);if(o.length!=4&&(n=",",o=e[0].split(n),o.length!=4))throw new Error("Header mismatch: Should be 4 comma- (*.csv) or tab-separated (*.tsv) headers: Date, Text, Amount, Category");if(o[0].trim()!=="Date"||o[1].trim()!=="Text"||o[2].trim()!=="Amount"||o[3].trim()!=="Category")throw new Error("Headers mismatch: Should be: Date, Text, Amount, Category");e=e.slice(1).filter(s=>!!s.trim());let r=0;const a=e.map((s,c)=>{if(s.trim()==="")return null;const i=s.split(n);if(i.length<4)throw new Error(`Data mismatch: Should be comma- (*.csv) or tab-separated (*.tsv): Date, Text, Amount, Category (Line ${c}): ${s}`);let[m,h,f,w]=i;return m=m.trim(),h=h.replace(/^"/g,"").replace(/"$/g,"").trim(),f=f.trim(),w=w.trim(),C(h,new Date(m),w,f),{name:h,amount:f,category:w,date:m}}).filter(s=>!!s);if(a.length<e.length)return g("Cancelling due to invalid payments found!");a.forEach(s=>{_(s)&&r++}),p(),z(),g(`Imported ${r}/${e.length} payments successfully`)}catch(t){console.error(t.message),console.error(t.stack),g(`Validation Error: ${t.message}`);return}}function W(){let t=new Date,e=u(t,"y-M"),n=u(new Date(Date.now()-t.getDate()*24*3600*1e3),"y-M");E("import",["Date,Text,Amount,Category",`${n}-01,"Food",180.25,Food`,`${n}-02,"Rent Costs",100,Flat`,`${n}-03,"Dog Food",100,Pets`,`${n}-04,"SwissLife",100,Pension`,`${n}-05,"Car Insurance",100,Insurance`,`${e}-01,"Food",100,Food`,`${e}-02,"Rent Costs",100,Flat`,`${e}-03,"Dog Food",80,Pets`,`${e}-04,"SwissLife",10,Pension`,`${e}-05,"Car Insurance",10,Insurance`].join(`
`))}function E(t,e){const n=document.getElementById(t);n.value=e}function me(){W(),g("Example data loaded. Click Import to add it")}function fe(){confirm("Definitely clear all payment data?")&&(l=[],F(),p(),g("Payments cleared"))}function Y(){d.clearRect(0,0,S,y),d.fillStyle=T?"#333":"white",d.fillRect(0,0,S,y),d.font="8pt sans-serif",d.strokeStyle=T?"#ccc":"gray",d.fillStyle=d.strokeStyle,d.lineWidth=1;let t=500;const e=Math.ceil(I/t);for(let r=0;r<e;r++){const a=(t*(e-r)).toString();d.fillText(a,0,r*y/e),d.beginPath(),d.moveTo(0,r*y/e),d.lineTo(S,r*y/e),d.stroke()}$.value;const n=K(u(new Date,"y-")+"01"),o=b/n.length;n.forEach((r,a)=>{J(n.indexOf(r),(a+1)*o,"rgba(100, 100, 100, 0.5)")})}function J(t,e,n){d.fillStyle=n;const o=S/32,r=e*y/I;v==="line"?d.fillRect(t*o,y-r,o,2):d.fillRect(t*o,y-r,o,r)}function K(t){if(!t)return[];const e=parseInt(t.substring(0,4),10),n=parseInt(t.substring(5,7),10),o=ge(e,n);return new Array(o).fill(0).map((r,a)=>u(new Date(e,n-1,a+1),"y-M-d"))}function ge(t,e){return new Date(t,e,0).getDate()}function u(t,e="y-M-d"){const n=new Date(t),o={y:n.getFullYear().toString(),M:("0"+(n.getMonth()+1)).toString().slice(-2),d:("0"+n.getDate()).toString().slice(-2),h:("0"+n.getHours()).toString().slice(-2),m:("0"+n.getMinutes()).toString().slice(-2),s:("0"+n.getSeconds()).toString().slice(-2)},r=Object.keys(o).join(""),a=new RegExp(`(?<!\\\\)[${r}]`,"g"),s=new RegExp(`\\\\([${r}])`,"g");return e.replace(a,c=>o[c]).replace(s,(c,i)=>i)}function ye(t){return Math.random().toString(36).replace("0.","")}function pe(t,e){return t>e?1:-1}function he(t,e){return t<e?1:-1}function we(t,e){return t.day<e.day?1:-1}function Se(t){return new Date(t).toLocaleString("en-us",{month:"short",day:"numeric"})}function $e(t){return new Date(t).toLocaleString("en-us",{weekday:"short",day:"numeric"})}function F(){const t=l.map(e=>({id:e.id,name:e.name,date:u(e.date,"y-M-d h:m:s"),category:e.category,amount:e.amount}));localStorage.setItem("payments",JSON.stringify(t))}function Ee(t){g(`ERROR: ${t.message}`)}window.addEventListener("load",oe);window.addEventListener("error",Ee);
