import*as a from"https://cdn.jsdelivr.net/npm/three@0.118/build/three.module.js";import"https://cdn.jsdelivr.net/npm/three@0.118/examples/jsm/controls/OrbitControls.js";(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))o(t);new MutationObserver(t=>{for(const i of t)if(i.type==="childList")for(const n of i.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&o(n)}).observe(document,{childList:!0,subtree:!0});function s(t){const i={};return t.integrity&&(i.integrity=t.integrity),t.referrerpolicy&&(i.referrerPolicy=t.referrerpolicy),t.crossorigin==="use-credentials"?i.credentials="include":t.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(t){if(t.ep)return;t.ep=!0;const i=s(t);fetch(t.href,i)}})();var A=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},P={},R={get exports(){return P},set exports(e){P=e}};(function(e,l){(function(s,o){e.exports=o()})(A,function(){var s=function(){function o(c){return n.appendChild(c.dom),c}function t(c){for(var p=0;p<n.children.length;p++)n.children[p].style.display=p===c?"block":"none";i=c}var i=0,n=document.createElement("div");n.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",n.addEventListener("click",function(c){c.preventDefault(),t(++i%n.children.length)},!1);var u=(performance||Date).now(),f=u,r=0,S=o(new s.Panel("FPS","#0ff","#002")),w=o(new s.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var h=o(new s.Panel("MB","#f08","#201"));return t(0),{REVISION:16,dom:n,addPanel:o,showPanel:t,begin:function(){u=(performance||Date).now()},end:function(){r++;var c=(performance||Date).now();if(w.update(c-u,200),c>f+1e3&&(S.update(1e3*r/(c-f),100),f=c,r=0,h)){var p=performance.memory;h.update(p.usedJSHeapSize/1048576,p.jsHeapSizeLimit/1048576)}return c},update:function(){u=this.end()},domElement:n,setMode:t}};return s.Panel=function(o,t,i){var n=1/0,u=0,f=Math.round,r=f(window.devicePixelRatio||1),S=80*r,w=48*r,h=3*r,c=2*r,p=3*r,y=15*r,x=74*r,g=30*r,k=document.createElement("canvas");k.width=S,k.height=w,k.style.cssText="width:80px;height:48px";var d=k.getContext("2d");return d.font="bold "+9*r+"px Helvetica,Arial,sans-serif",d.textBaseline="top",d.fillStyle=i,d.fillRect(0,0,S,w),d.fillStyle=t,d.fillText(o,h,c),d.fillRect(p,y,x,g),d.fillStyle=i,d.globalAlpha=.9,d.fillRect(p,y,x,g),{dom:k,update:function(v,E){n=Math.min(n,v),u=Math.max(u,v),d.fillStyle=i,d.globalAlpha=1,d.fillRect(0,0,S,y),d.fillStyle=t,d.fillText(f(v)+" "+o+" ("+f(n)+"-"+f(u)+")",h,c),d.drawImage(k,p+r,y,x-r,g,p,y,x-r,g),d.fillRect(p+x-r,y,r,g),d.fillStyle=i,d.globalAlpha=.9,d.fillRect(p+x-r,y,r,f((1-v/E)*g))}}},s})})(R);const W=P;let H=[];new a.DirectionalLight(16777215,1);H.push(new a.AmbientLight(10066329));function L(e){const l=new a.WebGLRenderer({alpha:!0,antialias:!0});return l.shadowMap.enabled=!0,l.shadowMap.type=a.PCFSoftShadowMap,l.setPixelRatio(window.devicePixelRatio),e.windowScale=Math.min(Math.floor(window.innerWidth/e.XW),Math.floor(window.innerHeight/e.YH)),l.setSize(e.windowSize.w,e.windowSize.h),document.body.appendChild(l.domElement),l}function z({onAdd:e,onRemove:l}){const s=[];return{e:s,add:o=>(typeof e=="function"&&e(o),s.push(o))}}function O(e,l,s,o){let t=.75*e/2,i;return i=new a.OrthographicCamera(-t*o,t*o,t,-t,100,-100),i.position.set(e/2,l/2,100),i}let C=new a.MeshLambertMaterial({color:3342387,opacity:1,blending:a.NoBlending,side:a.FrontSide,transparent:!1,depthTest:!1,wireframe:!1});const M=new a.Mesh(new a.PlaneGeometry(320,240,10,10),C);M.castShadow=!1;M.receiveShadow=!0;M.position.set(160,120,0);function D(e){let l=new a.MeshStandardMaterial({color:16711680}),s=new a.Mesh(new a.BoxGeometry(e.blockWidth*e.blockScale,e.blockHeight*e.blockScale,2),l);return s.update=G,s}function G(e){this.position.y+=1}function K({config:e,scene:l,entities:s}){const o=new a.Group;let t=new a.MeshStandardMaterial({color:16711935}),i=[[0,1,1,0],[0,1,1,0],[1,1,1,1],[1,1,1,1]];for(let n=0;n<4;n++)for(let u=0;u<4;u++){if(!i[3-u][n])continue;let f=new a.Mesh(new a.BoxGeometry(e.blockWidth*e.blockScale,e.blockHeight*e.blockScale,2),t);f.position.set(n*e.blockWidth,u*e.blockHeight,0),o.add(f)}return o.left=function(){this.speed.x-=1},o.right=function(){this.speed.x+=1},o.shoot=function(){let n=new D(e);n.position.set(o.position.x+1.5*e.blockWidth,o.position.y+4*e.blockHeight,0),o.add(n),l.add(n),s.add(n)},o.update=function(n){this.position.x+=this.speed.x},o.speed={x:0,y:0},l.add(o),s.add(o),o}function T({config:e,scene:l,entities:s,player:o}){const t=[new a.MeshStandardMaterial({color:3377203}),new a.MeshStandardMaterial({color:13421772}),new a.MeshStandardMaterial({color:221})];let i=e.blockWidth,n=e.blockHeight,u=e.XW/i,f=e.YH/n;for(let w=0;w<u;w++)for(let h=0;h<f;h++)(h<=3||h>f-7)&&r(w,h);o.position.set(...S(10,4));function r(w,h){let c=i*.8,p=n*.8;const y=new a.Mesh(new a.PlaneGeometry(c,p),t[1]);y.position.set(...S(w,h)),l.add(y),s.add(y)}function S(w,h){return[e.blockWidth/2+e.blockWidth*w,e.blockHeight/2+e.blockHeight*h,5]}}const b={XW:320,YH:240,blockWidth:5,blockHeight:5,blockScale:.8,windowScale:1,windowSize:{w:window.innerWidth,h:window.innerHeight}};function B(){let e,l,s,o,t,i;i=new z({onAdd:u,onRemove:f}),t=new a.Scene;let n={state:e,config:b,scene:t,player:o,entities:i,camera:l,renderer:s};return n.renderer=new L(b),n.state={running:!1},H.forEach(r=>t.add(r)),b.windowAspect=b.windowSize.w/b.windowSize.h,n.camera=O(b.XW,b.YH,b.windowScale,b.windowAspect),n.player=K(n),T(n),t.add(M),window.addEventListener("keydown",N.bind(this),!1),window.addEventListener("resize",Y.bind(this),!1),this.update=function(){this.entities.e.forEach(r=>{typeof r.update=="function"&&r.update()})},this.run=function(){this.state.running=!0,window.requestAnimationFrame(this.loop.bind(this))},this.loop=function(){this.state.running&&(this.renderer.render(t,this.camera),this.update(),this.run())},Object.assign(this,n),this.run(),this;function u(r){}function f(r){}}function F(){m.player.shoot()}function q(){m.state.running=m.state.running||!1}function I(){m.stats.dom.style.display=m.stats.dom.style.display==="none"?"":"none"}function N(e){if(X("Keypress",e.code),e.preventDefault(),["ArrowUp","KeyW"].includes(e.code))return F();if(["ArrowLeft","KeyA"].includes(e.code))return m.player.left();if(["ArrowRight","KeyD"].includes(e.code))return m.player.right();e.code==="KeyS"&&console.log(m.scene),e.code==="KeyP"&&q(),e.code==="KeyO"&&I()}const X=console.log.bind(console);function Y(){console.log(this.camera.aspect)}let m=null;window.addEventListener("DOMContentLoaded",()=>{m=new B,m.stats=new W,document.body.appendChild(m.stats.dom),requestAnimationFrame(function e(){m.stats.update(),requestAnimationFrame(e)}),window._APP=m});
